<!DOCTYPE html>
<html>
<head>
    <title>API SDK 3dRudder</title>
    <script src="../dist/3dRudder-2.0.3.js"></script>
    <script> 
        var SDK = new Sdk3dRudder();                   
        // initialized
        SDK.on('init', function(init) {
            console.log('init uid ' + init.uid + '= SDK uid ' + this.uid);
            document.getElementById('device').innerHTML = 'server is on SDK version:' + init.version;
            document.getElementById('main').hidden = false;
        });
        // on tick each frame 20ms
        SDK.on('frame', function(frame) {
            document.getElementById('out').innerHTML = JSON.stringify(frame, null, '\t');
        });        
        // error event
        SDK.on('error', function(error) {
            document.getElementById('error').innerHTML = 'ERROR :' + error.message;
        });
        // end connection
        SDK.on('end', function() {
            document.getElementById('device').innerHTML = 'connection is off';
            document.getElementById('main').hidden = true;
            connect = false;
            document.getElementById('button').innerHTML = "Start connection";
        });

        SDK.on('discovery', function(urls) {
            if (urls.length > 0) {
                //this.host = urls[i].ip;
                document.getElementById('servers').innerHTML = `<label for="server">${urls.length} server(s) found</label>`;
                var selectList = document.createElement("select");
                selectList.id = "server";
                document.getElementById('servers').appendChild(selectList);
                for(i in urls) {
                    var option = document.createElement("option");
                    option.value = urls[i].ip;
                    option.text = decodeURIComponent(escape(urls[i].name));
                    selectList.appendChild(option);
                    //document.getElementById('servers').innerHTML += `<option value=${urls[i].ip}>Ip: ${urls[i].ip} name: ${decodeURIComponent(escape(urls[i].name))} </option>`;
                }
            }
        });

        var connect = false;
        function startStop() {
            connect = !connect;
            if (connect) {                
                SDK.host = document.getElementById('server').value;
                SDK.init();
                document.getElementById('button').innerHTML = "Stop connection";
            }
            else {
                SDK.stop();
                document.getElementById('button').innerHTML = "Start connection";
            }
        }
        function playSound() {
            var form = document.forms["frm1"];
            SDK.playSound(parseInt(form["port"].value), parseInt(form["frequency"].value), parseInt(form["duration"].value), function(code) {
                document.getElementById('device').innerHTML = "sound played: " + SDK.getErrorString(code);
                console.log("sound");
            });
        }

        function freeze() {
            var form = document.forms["frmfreeze"];
            var controller = SDK.controllers[parseInt(form["port"].value)];
            controller.setFreeze(!controller.freeze, function(code, freeze) {
                document.getElementById('device').innerHTML = "frozen: " + SDK.getErrorString(code);
                document.getElementById('buttonFreeze').value = freeze ? "Unfreeze" : "Freeze";
            });
        }

        function tryDiscovery() {
            SDK.startDiscovery();
        }
    </script>
</head>
<body>
    <h1>Messages</h1>
    <button id="button" onClick="tryDiscovery()">Try Discovery</button>
    <div id="servers"></div>
    <button id="button" onClick="startStop()">Start connection</button>
    <br>
    <div id="device"></div>
    <div id="error"></div>
    <br>
    <div id="main" hidden=true>
        <form id="frm1">
            Port: <input type="number" name="port" value="0"><br>
            Frequency: <input type="number" name="frequency"><br>
            Duration: <input type="number" name="duration"><br><br>
            <input type="button" onclick="playSound()" value="PlaySound">
        </form>
        <form id="frmfreeze">
            Port: <input type="number" name="port" value="0"><br>
            <input type="button" onclick="freeze()" id="buttonFreeze" value="Freeze">
        </form>      
        <pre id="out"></pre>
    </div>
</body>
</html>